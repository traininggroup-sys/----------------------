<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø¬Ø±ÙˆØ¨ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />

    <style>
      :root {
        --bg-grad1: #f5f5f5;
        --bg-grad2: #eaeaea;
        --brand: #004e64;
        --accent: #0096c7;
        --accent-2: #00b4d8;
        --ink: #333;
        --muted: #777;
        --ok: #22c55e;
        --warn: #f59e0b;
        --card: #ffffff;
        --line: #dcdcdc;
      }
      * {
        box-sizing: border-box;
      }
      html,
      body {
        height: 100%;
        margin: 0;
        font-family: "Cairo", sans-serif;
        color: var(--ink);
        background: linear-gradient(to right, var(--bg-grad1), var(--bg-grad2));
      }

      /* Screens */
      .screen {
        display: none;
        min-height: 100vh;
        width: 100%;
      }
      .screen.active {
        display: block;
      }

      /* Start screen */
      .start-screen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        background: var(--brand);
        text-align: center;
        padding: 24px;
      }
      .start-screen h1 {
        color: #fff;
        margin: 10px 0 6px;
        font-size: 28px;
      }
      .start-screen img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 50%;
        border: 3px solid #fff;
        margin-bottom: 14px;
      }
      .start-input {
        padding: 10px 12px;
        border-radius: 12px;
        border: none;
        outline: none;
        width: min(260px, 80vw);
        margin: 8px 0;
      }
      .btn {
        cursor: pointer;
        border: none;
        border-radius: 999px;
        padding: 12px 22px;
        font-weight: 700;
      }
      .btn-primary {
        background: var(--accent);
        color: #fff;
      }
      .btn-ghost {
        background: #fff;
        color: var(--brand);
        border: 2px solid #fff;
      }
      .btn:active {
        transform: scale(0.98);
      }
      .row-gap {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 8px;
      }

      /* Module grid */
      .module-grid {
        padding: 34px 16px;
        background: #f0f8ff;
      }
      .module-grid h2 {
        text-align: center;
        margin: 0 0 18px;
      }
      .modules-wrap {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
      }
      .module-button {
        position: relative;
        background: #fff;
        border: 2px solid #ccc;
        border-radius: 15px;
        padding: 18px;
        font-size: 18px;
        min-width: 220px;
        cursor: pointer;
        transition: 0.25s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.08);
      }
      .module-button:hover {
        transform: translateY(-4px);
        background: #d9fdd3;
      }
      .module-button i {
        display: block;
        font-size: 26px;
        margin-bottom: 8px;
      }
      .module-check {
        position: absolute;
        top: 10px;
        left: 12px;
        font-size: 18px;
        color: var(--ok);
        display: none;
      }
      .module-button.done .module-check {
        display: block;
      }

      /* Main (section details) */
      main {
        padding: 18px;
        background: #fafafa;
      }
      .bar-top {
        display: flex;
        gap: 10px;
        align-items: center;
        flex-wrap: wrap;
        margin-bottom: 10px;
      }
      .back-btn {
        background: #aaa;
        color: #fff;
        padding: 8px 14px;
        border: none;
        border-radius: 10px;
        cursor: pointer;
      }
      .link-btn {
        background: #fff;
        border: 1px solid var(--accent);
        color: var(--accent);
        padding: 8px 14px;
        border-radius: 10px;
        cursor: pointer;
      }
      .module {
        background: #fff;
        border-radius: 12px;
        padding: 14px;
        margin-bottom: 18px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
        border: 1px solid #ccc;
      }
      .module h2 {
        margin: 0 0 10px;
        color: #023e8a;
        border-bottom: 2px solid #ccc;
        padding-bottom: 10px;
      }
      .model-title {
        background: #dbeafe;
        color: #1e3a8a;
        padding: 8px 12px;
        border-radius: 8px;
        margin: 14px 0 8px;
        font-weight: 700;
        display: flex;
        align-items: center;
        gap: 8px;
        justify-content: space-between;
        flex-wrap: wrap;
      }
      .open-btn {
        padding: 6px 10px;
        border-radius: 8px;
        border: 1px solid var(--accent);
        background: #e6f7fb;
        cursor: pointer;
        font-size: 14px;
      }
      .task {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px dashed #ccc;
      }
      .task input[type="checkbox"] {
        transform: scale(1.2);
        accent-color: var(--accent-2);
      }
      .task.completed {
        background: #d9fdd3;
        border-radius: 6px;
      }
      .motivator {
        text-align: center;
        font-weight: 700;
        color: #2e7d32;
        margin-top: 10px;
        min-height: 26px;
      }

      /* Progress bar */
      .progress-area {
        width: 100%;
        margin: 8px 0 14px;
      }
      .progress-label {
        display: flex;
        justify-content: space-between;
        font-size: 14px;
        color: #555;
        margin-bottom: 5px;
      }
      .progress-container {
        width: 100%;
        background: #e5e7eb;
        border-radius: 20px;
        height: 24px;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        width: 0%;
        background: var(--accent-2);
        text-align: center;
        color: #fff;
        font-weight: 700;
        will-change: width;
      }

      /* Celebration banner + confetti */
      .celebrate-banner {
        position: fixed;
        top: -80px;
        left: 50%;
        transform: translateX(-50%);
        background: linear-gradient(90deg, #22c55e, #06b6d4, #3b82f6);
        color: #fff;
        padding: 14px 20px;
        border-radius: 999px;
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        z-index: 9999;
        white-space: nowrap;
        font-weight: 700;
      }
      .celebrate-banner.show {
        top: 20px;
        transition: top 0.5s ease;
      }
      .confetti {
        position: fixed;
        top: -10px;
        font-size: 22px;
        animation: fall linear forwards;
        z-index: 9998;
        pointer-events: none;
      }
      @keyframes fall {
        to {
          transform: translateY(110vh) rotate(720deg);
          opacity: 0.9;
        }
      }

      /* Dua toast */
      .dua-toast {
        position: fixed;
        bottom: 24px;
        right: 24px;
        max-width: 300px;
        background: #eef8f0;
        color: #1f6f3f;
        border: 1px solid #ccead5;
        border-radius: 12px;
        padding: 10px 12px;
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        display: none;
        z-index: 9999;
        font-size: 14px;
      }
      .dua-toast .head {
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 700;
        margin-bottom: 4px;
      }
      .dua-toast small {
        display: block;
        margin-top: 6px;
        color: #4b5563;
      }

      /* Leaderboard */
      .leaderboard {
        padding: 22px;
      }
      .lb-card {
        background: var(--card);
        border: 1px solid var(--line);
        border-radius: 14px;
        padding: 14px;
        max-width: 900px;
        margin: 0 auto;
        box-shadow: 0 8px 18px rgba(0, 0, 0, 0.05);
      }
      .lb-head {
        display: flex;
        align-items: center;
        gap: 10px;
        justify-content: space-between;
        flex-wrap: wrap;
        margin-bottom: 10px;
      }
      .lb-list {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
      }
      .lb-list th,
      .lb-list td {
        padding: 10px 8px;
        border-bottom: 1px solid #eee;
        text-align: center;
      }
      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        padding: 4px 10px;
        border-radius: 999px;
        font-size: 12px;
        border: 1px solid #e5e7eb;
        background: #f8fafc;
      }
      .medal {
        font-size: 18px;
      }
      .subtle {
        color: #6b7280;
        font-size: 12px;
      }
      .pill {
        display: inline-block;
        padding: 2px 8px;
        border-radius: 999px;
        background: #eef2ff;
        color: #4338ca;
        font-size: 12px;
      }
      .invisible {
        visibility: hidden;
      }
    </style>
  </head>
  <body>
    <!-- Screen 1: Start -->
    <section id="screen-start" class="screen start-screen active">
      <img src="5776125144014639249.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¬Ø±ÙˆØ¨" />
      <h1>Ø¬Ø±ÙˆØ¨ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h1>
      <input id="nameInput" class="start-input" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" />
      <div class="row-gap">
        <button class="btn btn-primary" id="btnStart">
          Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¢Ù†
        </button>
        <button class="btn btn-ghost" id="btnGoLB">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</button>
      </div>
    </section>

    <!-- Screen 2: Modules -->
    <section id="screen-modules" class="screen module-grid">
      <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙˆØ± Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</h2>
      <div class="row-gap">
        <button class="btn link-btn" id="btnBackToStart">Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
        <button class="btn link-btn" id="btnLeaderboard1">
          Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†
        </button>
      </div>
      <div class="modules-wrap" id="modules-container"></div>
    </section>

    <!-- Screen 3: Section details -->
    <main id="screen-main" class="screen">
      <div class="bar-top">
        <button class="back-btn" id="btnBackToModules">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
        <button class="link-btn" id="btnLeaderboard2">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</button>
      </div>

      <div class="progress-area">
        <div class="progress-label">
          <span id="progress-title">Ù†Ø³Ø¨Ø© Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø­ÙˆØ±</span>
          <span id="progress-count">0 / 0</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar">0%</div>
        </div>
      </div>

      <div id="content" class="invisible"></div>
      <div class="motivator" id="motivator"></div>
    </main>

    <!-- Screen 4: Leaderboard -->
    <section id="screen-lb" class="screen leaderboard">
      <div class="lb-card">
        <div class="lb-head">
          <div>
            <h2 style="margin: 0">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</h2>
            <div class="subtle">
              ÙŠØªÙ… Ø­Ø³Ø§Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø© Ù…Ù† Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ù…ÙƒØªÙ…Ù„Ø© Ù„ÙƒÙ„ Ø§Ù„Ù…Ø­Ø§ÙˆØ±
            </div>
          </div>
          <div class="row-gap">
            <button class="btn link-btn" id="btnLBBackStart">Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
            <button class="btn link-btn" id="btnLBBackModules">Ø§Ù„Ù…Ø­Ø§ÙˆØ±</button>
          </div>
        </div>
        <table class="lb-list" id="lbTable">
          <thead>
            <tr>
              <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ØªÙ‚Ø¯Ù…</th>
              <th>Ø£ÙˆØ³Ù…Ø©</th>
              <th>Ø¢Ø®Ø± ØªØ­Ø¯ÙŠØ«</th>
            </tr>
          </thead>
          <tbody id="lbBody"></tbody>
        </table>
        <div class="subtle" style="margin-top: 8px">
          ğŸ’¡ ÙŠØªÙ… Ø§Ù„ØªØ±ØªÙŠØ¨ ØªÙ„Ù‚Ø§Ø¦ÙŠÙ‹Ø§â€”Ø£ÙƒÙ…Ù„ Ù…Ù‡Ø§Ù… Ø£ÙƒØ«Ø± Ù„ØªØªÙ‚Ø¯Ù…!
        </div>
      </div>
    </section>

    <!-- Celebration banner -->
    <div id="celebrateBanner" class="celebrate-banner">
      ğŸ† Ø¨Ø±Ø§ÙÙˆÙˆ! Ø¥Ù†Ø¬Ø§Ø² Ø±Ù‡ÙŠØ¨!
    </div>

    <!-- Dua toast -->
    <div id="duaToast" class="dua-toast">
      <div class="head">
        <span id="duaIcon">ğŸ“š</span><span>Ø¯Ø¹Ø§Ø¡ ØªØ­ÙÙŠØ²ÙŠ</span>
      </div>
      <div id="duaText"></div>
      <small>Ø¬Ø±ÙˆØ¨ Ø§Ù„Ù…Ø´ØªØ±ÙƒÙŠÙ† Ù„Ù„ØªØ¯Ø±ÙŠØ¨ Ù…Ø¨Ø³ÙˆØ· Ø¨Ø¥Ù†Ø¬Ø§Ø²Ùƒ ğŸ¤—</small>
    </div>

    <!-- Firebase App -->
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-database-compat.js"></script>

    <script>
      /* ================== DATA ================== */
      const TASKS = ["Ù…Ø°Ø§ÙƒØ±Ø©/Ù…Ø´Ø§Ù‡Ø¯Ø©", "Ø­Ù„ Ø§Ù„Ø§Ø³ØªÙØªØ§Ø¡Ø§Øª", "Ø­Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙˆÙ‚Øª"];
      const DUAS = [
        {
          icon: "ğŸ“š",
          text: "Ø§Ù„Ù„Ù‡Ù… Ø¹Ù„Ù‘Ù…Ù†ÙŠ Ù…Ø§ ÙŠÙ†ÙØ¹Ù†ÙŠ ÙˆØ§Ù†ÙØ¹Ù†ÙŠ Ø¨Ù…Ø§ Ø¹Ù„Ù‘Ù…ØªÙ†ÙŠ ÙˆØ²Ø¯Ù†ÙŠ Ø¹Ù„Ù…Ù‹Ø§",
        },
        { icon: "ğŸŒŸ", text: "Ø§Ù„Ù„Ù‡Ù… Ø§ÙØªØ­ Ù„ÙŠ Ø£Ø¨ÙˆØ§Ø¨ Ø­ÙƒÙ…ØªÙƒ ÙˆØ§Ù†Ø´Ø± Ø¹Ù„ÙŠÙ‘ Ø±Ø­Ù…ØªÙƒ" },
        { icon: "âœ¨", text: "Ø§Ù„Ù„Ù‡Ù… Ø§Ø¬Ø¹Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù„Ù… Ø­Ø¬Ø© Ù„ÙŠ Ù„Ø§ Ø¹Ù„ÙŠÙ‘" },
        { icon: "ğŸ’–", text: "Ø§Ù„Ù„Ù‡Ù… ØµÙ„Ù‘Ù ÙˆØ³Ù„Ù… Ø¹Ù„Ù‰ Ù†Ø¨ÙŠÙ†Ø§ Ù…Ø­Ù…Ø¯" },
        { icon: "ğŸ•Šï¸", text: "Ø§Ù„Ù„Ù‡Ù… Ø§Ø±Ø²Ù‚Ù†ÙŠ Ø§Ù„ÙÙ‡Ù… Ø§Ù„Ø³Ù„ÙŠÙ… ÙˆØ§Ù„Ø­ÙØ¸ Ø§Ù„Ù‚ÙˆÙŠ" },
      ];

      const moduleData = {
        "ğŸ“˜ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©": { type: "models", count: 22, icon: "fa-lightbulb" },
        "ğŸ’» Ø­Ø§Ø³Ø¨": {
          type: "list",
          icon: "fa-computer",
          items: [
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 1", url: "https://youtu.be/aTGmvmeDJf8" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 2", url: "https://youtu.be/9tye0LUQfYI" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 3", url: "https://youtu.be/N3Z5p65om0o" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 4", url: "https://youtu.be/_HwWcpqTdHI" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 6", url: "https://youtu.be/1DbFtQZpsW0" },
            { title: "Ø¨Ø±Ù†Ø§Ù…Ø¬ Excel", url: "https://youtu.be/JzsTom7tTx8" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 7", url: "https://youtu.be/jUBGca5qRnM" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 8", url: "https://youtu.be/q3Zz99bThyQ" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 9", url: "https://youtu.be/_Ea_z_Ft4bs" },
            {
              title: "Ø´Ø±Ø­ Ø§Ø®ØªØ¨Ø§Ø± Ø¹Ù„ÙŠ Excel",
              url: "https://youtu.be/qn5rs-4mFJo",
            },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 10", url: "https://youtu.be/hRAdE691Mg4" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 11", url: "https://youtu.be/LNlw1VhnDWM" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 12", url: "https://youtu.be/mdgj-gbvOIg" },
            { title: "Ø¨Ø±Ù†Ø§Ù…Ø¬ Excel", url: "https://youtu.be/GI8RU0FXXO4" },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 13", url: "https://youtu.be/sTGkL7xYwCE" },
            { title: "Ø¨Ø±Ù†Ø§Ù…Ø¬ Access", url: "https://youtu.be/SOFszLmW_X8" },
            {
              title: "Ø¨Ø±Ù†Ø§Ù…Ø¬ PowerPoint Ø¬Ø²Ø¡ Ù¡",
              url: "https://youtu.be/53ydwEIFrog",
            },
            {
              title: "Ø¨Ø±Ù†Ø§Ù…Ø¬ PowerPoint Ø¬Ø²Ø¡ Ù¢",
              url: "https://youtu.be/yCvhQdWY0ac",
            },
            { title: "ÙÙŠØ¯ÙŠÙˆ Ø±Ù‚Ù… 14", url: "https://youtu.be/8ypgm2RJ804" },
            { title: "Ø£Ù‡Ù… Ø§Ù„Ø§Ø®ØªØµØ§Ø±Ø§Øª", url: "https://youtu.be/lhjovAocMMw" },
            { title: "Ø§Ø³Ø¦Ù„Ø© Ù…Ø¬Ù…Ø¹Ø©", url: "https://youtu.be/BgYzh47Icm0" },
            { title: "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ 1", url: "https://youtu.be/evZEGltYYXs" },
            { title: "Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ 2", url: "https://youtu.be/U_jAqbzbjRA" },
          ],
        },
        "ğŸ—£ï¸ Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ": { type: "models", count: 16, icon: "fa-language" },
        "ğŸ“™ Ø¹Ø±Ø¨ÙŠ": { type: "models", count: 17, icon: "fa-book" },
      };

      /* ================== STATE ================== */
      let username = "",
        userKey = "",
        userData = {},
        completedSections = {},
        selectedSection = "";

      const firebaseConfig = {
        apiKey: "AIzaSyD8OVH4XP4AOCCRcEjp-BWLXuIBDzEbdcU",
        authDomain: "motivationapp-a3890.firebaseapp.com",
        databaseURL: "https://motivationapp-a3890-default-rtdb.firebaseio.com",
        projectId: "motivationapp-a3890",
        storageBucket: "motivationapp-a3890.appspot.com",
        messagingSenderId: "231712261826",
        appId: "1:231712261826:web:6285e51747ca8bb6b21d5b",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      const STORAGE = {
        userKey: (name) => `centralUser_${name}`,
        doneSectionsKey: (name) => `centralUser_${name}_completedSections`,
      };

      /* ================== HELPERS ================== */
      function showScreen(id) {
        document
          .querySelectorAll(".screen, main")
          .forEach((s) => s.classList.remove("active"));
        const el = document.getElementById(id);
        el.classList.add("active");
      }

      function saveUserData() {
        if (!username) return;
        localStorage.setItem(userKey, JSON.stringify(userData));
        localStorage.setItem(
          STORAGE.doneSectionsKey(username),
          JSON.stringify(completedSections)
        );
        updateLeaderboardSnapshot();
      }

      function computeOverallProgress(userName) {
        let grandTotal = 0,
          done = 0;
        for (const section in moduleData) {
          const md = moduleData[section];
          const items = md.type === "models" ? md.count : md.items.length;
          grandTotal += items * TASKS.length;
          for (const k in userData) {
            if (userData[k] && k.startsWith(section + "_")) done++;
          }
        }
        return {
          done,
          grandTotal,
          pct: grandTotal ? Math.round((done / grandTotal) * 100) : 0,
        };
      }

      function updateLeaderboardSnapshot() {
        if (!username) return;
        const { done, grandTotal, pct } = computeOverallProgress(username);
        db.ref("users/" + username).set({
          name: username,
          done,
          total: grandTotal,
          pct,
          updatedAt: new Date().toISOString(),
        });
      }

      function renderLeaderboard() {
        db.ref("users").once("value", (snapshot) => {
          const users = snapshot.val() || {};
          const tbody = document.querySelector("#lbBody");
          tbody.innerHTML = "";
          Object.values(users)
            .sort((a, b) => b.pct - a.pct)
            .forEach((r, i) => {
              const medal =
                i === 0 ? "ğŸ¥‡" : i === 1 ? "ğŸ¥ˆ" : i === 2 ? "ğŸ¥‰" : "â€”";
              const badge =
                r.pct >= 90
                  ? "ğŸ–ï¸ Ø¨Ø·Ù„ Ù…ØªÙÙˆÙ‘Ù‚"
                  : r.pct >= 70
                  ? "â­ Ù…ØªÙ‚Ø¯Ù…"
                  : r.pct >= 40
                  ? "ğŸ’ª Ù…Ø«Ø§Ø¨Ø±"
                  : "ğŸš€ Ø¨Ø¯Ø§ÙŠØ© Ù‚ÙˆÙŠØ©";
              const tr = document.createElement("tr");
              tr.innerHTML = `<td>${medal}</td><td>${r.name}</td><td><strong>${
                r.pct
              }%</strong> (${r.done}/${
                r.total
              })</td><td>${badge}</td><td>${new Date(
                r.updatedAt
              ).toLocaleString("ar-EG")}</td>`;
              tbody.appendChild(tr);
            });
        });
      }

      function bootstrap() {
        const saved = localStorage.getItem("savedName");
        if (saved) {
          username = saved;
          userKey = STORAGE.userKey(username);
          userData = JSON.parse(localStorage.getItem(userKey) || "{}");
          completedSections = JSON.parse(
            localStorage.getItem(STORAGE.doneSectionsKey(username)) || "{}"
          );
          document.querySelector("#nameInput").value = saved;
        }
      }
      bootstrap();

      /* ================== EVENT LISTENERS ================== */
      document.getElementById("btnStart").addEventListener("click", () => {
        const val = document.getElementById("nameInput").value.trim();
        if (!val) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ!");
        username = val;
        userKey = STORAGE.userKey(username);
        localStorage.setItem("savedName", username);
        userData = JSON.parse(localStorage.getItem(userKey) || "{}");
        completedSections = JSON.parse(
          localStorage.getItem(STORAGE.doneSectionsKey(username)) || "{}"
        );
        showScreen("screen-modules");
        renderModules();
      });

      document
        .getElementById("btnBackToStart")
        .addEventListener("click", () => showScreen("screen-start"));
      document.getElementById("btnGoLB").addEventListener("click", () => {
        showScreen("screen-lb");
        renderLeaderboard();
      });
      document
        .getElementById("btnLeaderboard1")
        .addEventListener("click", () => {
          showScreen("screen-lb");
          renderLeaderboard();
        });
      document
        .getElementById("btnLeaderboard2")
        .addEventListener("click", () => {
          showScreen("screen-lb");
          renderLeaderboard();
        });
      document
        .getElementById("btnLBBackStart")
        .addEventListener("click", () => showScreen("screen-start"));
      document
        .getElementById("btnLBBackModules")
        .addEventListener("click", () => showScreen("screen-modules"));
      document
        .getElementById("btnBackToModules")
        .addEventListener("click", () => showScreen("screen-modules"));

      /* ================== MODULES ================== */
      function renderModules() {
        const container = document.getElementById("modules-container");
        container.innerHTML = "";
        for (const [key, val] of Object.entries(moduleData)) {
          const btn = document.createElement("div");
          btn.className =
            "module-button" + (completedSections[key] ? " done" : "");
          btn.innerHTML = `<i class="fa ${val.icon}"></i> ${key} <span class="module-check">âœ”ï¸</span>`;
          btn.addEventListener("click", () => openModule(key));
          container.appendChild(btn);
        }
      }

      function openModule(section) {
        selectedSection = section;
        showScreen("screen-main");
        const content = document.getElementById("content");
        content.innerHTML = "";
        content.classList.remove("invisible");
        const md = moduleData[section];
        if (md.type === "models") {
          for (let i = 1; i <= md.count; i++) {
            const div = document.createElement("div");
            div.className = "model-title";
            div.textContent = `Ù†Ù…ÙˆØ°Ø¬ ${i}`;
            const taskList = document.createElement("div");
            TASKS.forEach((task) => {
              const tdiv = document.createElement("div");
              tdiv.className = "task";
              tdiv.innerHTML = `<span>${task}</span><input type="checkbox" data-key="${section}_${i}_${task}"/>`;
              taskList.appendChild(tdiv);
            });
            div.appendChild(taskList);
            content.appendChild(div);
          }
        } else if (md.type === "list") {
          md.items.forEach((item, i) => {
            const div = document.createElement("div");
            div.className = "model-title";
            div.innerHTML = `<span>${item.title}</span> <a href="${item.url}" target="_blank" class="open-btn">Ø´Ø§Ù‡Ø¯</a>`;
            const taskList = document.createElement("div");
            TASKS.forEach((task) => {
              const tdiv = document.createElement("div");
              tdiv.className = "task";
              tdiv.innerHTML = `<span>${task}</span><input type="checkbox" data-key="${section}_${i}_${task}"/>`;
              taskList.appendChild(tdiv);
            });
            div.appendChild(taskList);
            content.appendChild(div);
          });
        }
        // Restore checked
        content.querySelectorAll("input[type=checkbox]").forEach((cb) => {
          const k = cb.dataset.key;
          if (userData[k]) cb.checked = true;
          cb.addEventListener("change", () => {
            userData[k] = cb.checked;
            if (cb.checked) cb.parentElement.classList.add("completed");
            else cb.parentElement.classList.remove("completed");
            updateProgress();
            saveUserData();
          });
        });
        updateProgress();
      }

      function updateProgress() {
        const md = moduleData[selectedSection];
        const total =
          md.type === "models"
            ? md.count * TASKS.length
            : md.items.length * TASKS.length;
        let done = 0;
        for (const k in userData)
          if (k.startsWith(selectedSection + "_") && userData[k]) done++;
        const pct = total ? Math.round((done / total) * 100) : 0;
        document.getElementById(
          "progress-count"
        ).textContent = `${done} / ${total}`;
        const bar = document.getElementById("progress-bar");
        bar.style.width = `${pct}%`;
        bar.textContent = `${pct}%`;
        // Show motivator
        const motiv = document.getElementById("motivator");
        motiv.textContent = DUAS[Math.floor(Math.random() * DUAS.length)].text;
        if (done === total) completedSections[selectedSection] = true;
        else delete completedSections[selectedSection];
      }
    </script>
  </body>
</html>
