<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>جروب أسئلة الجهاز المركزي</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      body {
        margin: 0;
        font-family: "Cairo", sans-serif;
        background: linear-gradient(to right, #f5f5f5, #eaeaea);
        color: #333;
      }

      .start-screen {
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        height: 100vh;
        background-color: #004e64;
        text-align: center;
        padding: 20px;
      }

      .start-screen h1 {
        font-size: 32px;
        color: white;
        margin-bottom: 10px;
      }

      .start-screen img {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 50%;
        border: 3px solid white;
        margin-bottom: 15px;
      }

      .start-screen input {
        padding: 10px;
        font-size: 16px;
        border-radius: 5px;
        border: none;
        margin-bottom: 15px;
        width: 250px;
        text-align: center;
      }

      .start-btn {
        padding: 12px 30px;
        font-size: 18px;
        background-color: #00a896;
        border: none;
        border-radius: 25px;
        color: white;
        cursor: pointer;
        transition: background 0.3s;
      }

      .start-btn:hover {
        background-color: #028090;
      }

      main {
        display: none;
        padding: 20px;
        background-color: #fefefe;
      }

      .section {
        margin-bottom: 40px;
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
      }

      .section h2 {
        color: #004e64;
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .section h2 i {
        color: #0077b6;
      }

      .model-box {
        background-color: #ffffff;
        border: 1px solid #ddd;
        border-radius: 8px;
        margin-top: 10px;
        padding: 15px;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
      }

      .task {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
      }

      .task.completed {
        background-color: #e0f7d3;
        border-radius: 5px;
      }

      .progress-bar {
        margin: 10px 0 20px;
      }

      .progress-value {
        background-color: #f0f0f0;
        border-radius: 10px;
        overflow: hidden;
        height: 20px;
      }

      .progress-value span {
        display: block;
        height: 100%;
        background-color: #0077b6;
        color: white;
        text-align: center;
        line-height: 20px;
        transition: width 0.4s ease;
      }

      .motivator {
        font-weight: bold;
        color: #1b4332;
        margin-top: 10px;
      }
    </style>
  </head>
  <body>
    <section class="start-screen" id="start-screen">
      <img src="logo.jpg" alt="شعار الجروب" />
      <h1>جروب أسئلة الجهاز المركزي</h1>
      <input type="text" id="usernameInput" placeholder="اكتب اسمك هنا" />
      <button class="start-btn" onclick="startApp()">ابدأ المذاكرة الآن</button>
    </section>

    <main id="main"></main>

    <script>
      const modules = {
        "معلومات عامة": { count: 1, icon: "fa-lightbulb" },
        عربي: { count: 1, icon: "fa-book-open" },
        حاسب: { count: 1, icon: "fa-laptop-code" },
        انجليزي: { count: 1, icon: "fa-language" },
      };

      const tasks = ["مذاكرة النموذج", "حل الاستفتاءات", "حل الاختبار بوقت"];
      let username = "";
      let userKey = "";
      let userData = {};

      const startApp = () => {
        const name = document.getElementById("usernameInput").value.trim();
        if (!name) return alert("من فضلك أدخل الاسم");
        username = name;
        userKey = `centralUser_${username}`;
        userData = JSON.parse(localStorage.getItem(userKey)) || {};
        document.getElementById("start-screen").style.display = "none";
        document.getElementById("main").style.display = "block";
        renderSections();
      };

      const renderSections = () => {
        const main = document.getElementById("main");
        main.innerHTML = "";

        Object.entries(modules).forEach(([section, { count, icon }]) => {
          const sectionDiv = document.createElement("div");
          sectionDiv.className = "section";

          const heading = document.createElement("h2");
          heading.innerHTML = `<i class="fa-solid ${icon}"></i> ${section}`;
          sectionDiv.appendChild(heading);

          const progress = document.createElement("div");
          progress.className = "progress-bar";
          const progressInner = document.createElement("div");
          progressInner.className = "progress-value";
          const span = document.createElement("span");
          span.textContent = "0%";
          progressInner.appendChild(span);
          progress.appendChild(progressInner);
          sectionDiv.appendChild(progress);

          let completedInSection = 0;

          for (let i = 1; i <= count; i++) {
            const modelBox = document.createElement("div");
            modelBox.className = "model-box";
            const title = document.createElement("h3");
            title.textContent = `نموذج ${i}`;
            modelBox.appendChild(title);

            let modelCompleted = 0;

            tasks.forEach((task, idx) => {
              const taskDiv = document.createElement("div");
              taskDiv.className = "task";
              const label = document.createElement("label");
              label.textContent = task;
              const checkbox = document.createElement("input");
              checkbox.type = "checkbox";
              const taskKey = `${section}_${i}_${idx}`;

              if (userData[taskKey]) {
                checkbox.checked = true;
                taskDiv.classList.add("completed");
                modelCompleted++;
                completedInSection++;
              }

              checkbox.addEventListener("change", () => {
                userData[taskKey] = checkbox.checked;
                localStorage.setItem(userKey, JSON.stringify(userData));
                taskDiv.classList.toggle("completed", checkbox.checked);
                updateSectionProgress(sectionDiv, section, count);
                showMotivation(modelBox, section, i);
              });

              taskDiv.appendChild(label);
              taskDiv.appendChild(checkbox);
              modelBox.appendChild(taskDiv);
            });

            const motivator = document.createElement("div");
            motivator.className = "motivator";
            modelBox.appendChild(motivator);

            sectionDiv.appendChild(modelBox);
          }

          updateSectionProgress(sectionDiv, section, count);
          main.appendChild(sectionDiv);
        });
      };

      const updateSectionProgress = (sectionDiv, section, modelCount) => {
        const checkboxes = sectionDiv.querySelectorAll(
          'input[type="checkbox"]'
        );
        const checked = [...checkboxes].filter((c) => c.checked).length;
        const total = modelCount * tasks.length;
        const percent = Math.round((checked / total) * 100);
        const span = sectionDiv.querySelector(".progress-value span");
        span.style.width = `${percent}%`;
        span.textContent = `${percent}%`;
      };

      const showMotivation = (modelBox, section, modelNum) => {
        const motivator = modelBox.querySelector(".motivator");
        const keys = tasks.map((_, idx) => `${section}_${modelNum}_${idx}`);
        const done = keys.every((k) => userData[k]);
        if (done) {
          motivator.textContent =
            "✅ تم إنجاز النموذج بالكامل، أحسنت! ربنا يوفقك ويبارك في وقتك.";
        } else {
          motivator.textContent = "";
        }
      };
    </script>
  </body>
</html>
