<!DOCTYPE html>
<html lang="ar" dir="rtl">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ø¬Ø±ÙˆØ¨ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <style>
      /* ======== CSS Ù…Ø®ØªØµØ± Ù…Ù† Ø§Ù„Ø¬Ø²Ø¡ Ø§Ù„Ø³Ø§Ø¨Ù‚ ======== */
      :root {
        --bg-grad1: #f5f5f5;
        --bg-grad2: #eaeaea;
        --brand: #004e64;
        --accent: #0096c7;
        --accent-2: #00b4d8;
        --ink: #333;
        --ok: #22c55e;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: "Cairo", sans-serif;
        color: var(--ink);
        background: linear-gradient(to right, var(--bg-grad1), var(--bg-grad2));
      }
      .screen {
        display: none;
        min-height: 100vh;
        width: 100%;
      }
      .screen.active {
        display: block;
      }
      .btn {
        cursor: pointer;
        border: none;
        border-radius: 999px;
        padding: 12px 22px;
        font-weight: 700;
      }
      .btn-primary {
        background: var(--accent);
        color: #fff;
      }
      .btn-ghost {
        background: #fff;
        color: var(--brand);
        border: 2px solid #fff;
      }
      .row-gap {
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
        justify-content: center;
        margin-top: 8px;
      }
      .module-grid {
        padding: 34px 16px;
        background: #f0f8ff;
      }
      .modules-wrap {
        display: flex;
        flex-wrap: wrap;
        gap: 16px;
        justify-content: center;
      }
      .module-button {
        position: relative;
        background: #fff;
        border: 2px solid #ccc;
        border-radius: 15px;
        padding: 18px;
        font-size: 18px;
        min-width: 220px;
        cursor: pointer;
        transition: 0.25s;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.08);
      }
      .module-button:hover {
        transform: translateY(-4px);
        background: #d9fdd3;
      }
      .module-check {
        position: absolute;
        top: 10px;
        left: 12px;
        font-size: 18px;
        color: var(--ok);
        display: none;
      }
      .module-button.done .module-check {
        display: block;
      }
      .progress-area {
        width: 100%;
        margin: 8px 0 14px;
      }
      .progress-container {
        width: 100%;
        background: #e5e7eb;
        border-radius: 20px;
        height: 24px;
        overflow: hidden;
      }
      .progress-bar {
        height: 100%;
        width: 0%;
        background: var(--accent-2);
        text-align: center;
        color: #fff;
        font-weight: 700;
      }
    </style>
  </head>
  <body>
    <!-- Screen 1: Start -->
    <section id="screen-start" class="screen active">
      <img src="5776125144014639249.jpg" alt="Ø´Ø¹Ø§Ø± Ø§Ù„Ø¬Ø±ÙˆØ¨" />
      <h1>Ø¬Ø±ÙˆØ¨ Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ø¬Ù‡Ø§Ø² Ø§Ù„Ù…Ø±ÙƒØ²ÙŠ</h1>
      <input id="nameInput" class="start-input" placeholder="Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ" />
      <div class="row-gap">
        <button class="btn btn-primary" id="btnStart">
          Ø§Ø¨Ø¯Ø£ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø© Ø§Ù„Ø¢Ù†
        </button>
        <button class="btn btn-ghost" id="btnGoLB">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</button>
      </div>
    </section>

    <!-- Screen 2: Modules -->
    <section id="screen-modules" class="screen module-grid">
      <h2>Ø§Ø®ØªØ± Ø§Ù„Ù…Ø­ÙˆØ± Ù„Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø°Ø§ÙƒØ±Ø©</h2>
      <div class="row-gap">
        <button class="btn link-btn" id="btnBackToStart">Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
        <button class="btn link-btn" id="btnLeaderboard1">
          Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†
        </button>
      </div>
      <div class="modules-wrap" id="modules-container"></div>
    </section>

    <!-- Screen 3: Section details -->
    <main id="screen-main" class="screen">
      <div class="bar-top">
        <button class="back-btn" id="btnBackToModules">ğŸ”™ Ø±Ø¬ÙˆØ¹</button>
        <button class="link-btn" id="btnLeaderboard2">Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</button>
      </div>
      <div class="progress-area">
        <div class="progress-label">
          <span id="progress-title">Ù†Ø³Ø¨Ø© Ø¥Ù†Ø¬Ø§Ø² Ø§Ù„Ù…Ø­ÙˆØ±</span>
          <span id="progress-count">0 / 0</span>
        </div>
        <div class="progress-container">
          <div class="progress-bar" id="progress-bar">0%</div>
        </div>
      </div>
      <div id="content"></div>
    </main>

    <!-- Screen 4: Leaderboard -->
    <section id="screen-lb" class="screen leaderboard">
      <div class="lb-card">
        <div class="lb-head">
          <h2>Ù„ÙˆØ­Ø© Ø§Ù„Ù…ØªØµØ¯Ø±ÙŠÙ† ğŸ†</h2>
          <div class="row-gap">
            <button class="btn link-btn" id="btnLBBackStart">Ø§Ù„Ø±Ø¬ÙˆØ¹</button>
            <button class="btn link-btn" id="btnLBBackModules">Ø§Ù„Ù…Ø­Ø§ÙˆØ±</button>
          </div>
        </div>
        <table class="lb-list" id="lbTable">
          <thead>
            <tr>
              <th>Ø§Ù„ØªØ±ØªÙŠØ¨</th>
              <th>Ø§Ù„Ø§Ø³Ù…</th>
              <th>Ø§Ù„ØªÙ‚Ø¯Ù…</th>
            </tr>
          </thead>
          <tbody id="lbBody"></tbody>
        </table>
      </div>
    </section>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/12.1.0/firebase-database-compat.js"></script>

    <script>
      // ====== Ø¨ÙŠØ§Ù†Ø§Øª ØªØ¬Ø±ÙŠØ¨ÙŠØ© ======
      const TASKS = ["Ù…Ø°Ø§ÙƒØ±Ø©/Ù…Ø´Ø§Ù‡Ø¯Ø©", "Ø­Ù„ Ø§Ù„Ø§Ø³ØªÙØªØ§Ø¡Ø§Øª", "Ø­Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨ÙˆÙ‚Øª"];
      const moduleData = {
        "ğŸ“˜ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø¹Ø§Ù…Ø©": { type: "models", count: 5 },
        "ğŸ’» Ø­Ø§Ø³Ø¨": {
          type: "list",
          items: [{ title: "Ø¯Ø±Ø³ 1" }, { title: "Ø¯Ø±Ø³ 2" }],
        },
        "ğŸ—£ï¸ Ø§Ù†Ø¬Ù„ÙŠØ²ÙŠ": { type: "models", count: 3 },
      };

      let username = "",
        completedSections = {},
        selectedSection = "";

      // Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyD8OVH4XP4AOCCRcEjp-BWLXuIBDzEbdcU",
        authDomain: "motivationapp-a3890.firebaseapp.com",
        databaseURL: "https://motivationapp-a3890-default-rtdb.firebaseio.com",
        projectId: "motivationapp-a3890",
        storageBucket: "motivationapp-a3890.appspot.com",
        messagingSenderId: "231712261826",
        appId: "1:231712261826:web:6285e51747ca8bb6b21d5b",
      };
      firebase.initializeApp(firebaseConfig);
      const db = firebase.database();

      // ====== Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø§Ø´Ø© ======
      const screenStart = document.getElementById("screen-start");
      const screenModules = document.getElementById("screen-modules");
      const screenMain = document.getElementById("screen-main");
      const screenLB = document.getElementById("screen-lb");

      const btnStart = document.getElementById("btnStart");
      const btnGoLB = document.getElementById("btnGoLB");
      const btnBackToStart = document.getElementById("btnBackToStart");
      const btnLeaderboard1 = document.getElementById("btnLeaderboard1");
      const btnBackToModules = document.getElementById("btnBackToModules");
      const btnLeaderboard2 = document.getElementById("btnLeaderboard2");
      const btnLBBackStart = document.getElementById("btnLBBackStart");
      const btnLBBackModules = document.getElementById("btnLBBackModules");

      const modulesContainer = document.getElementById("modules-container");
      const content = document.getElementById("content");
      const progressBar = document.getElementById("progress-bar");
      const progressCount = document.getElementById("progress-count");
      const lbBody = document.getElementById("lbBody");

      function showScreen(screen) {
        [screenStart, screenModules, screenMain, screenLB].forEach((s) =>
          s.classList.remove("active")
        );
        screen.classList.add("active");
      }

      // ====== ØªÙˆÙ„ÙŠØ¯ Ø§Ù„Ù…Ø­Ø§ÙˆØ± ======
      function renderModules() {
        modulesContainer.innerHTML = "";
        for (const [name, data] of Object.entries(moduleData)) {
          const btn = document.createElement("button");
          btn.className = "module-button";
          btn.textContent = name;
          btn.addEventListener("click", () => {
            selectedSection = name;
            renderSection();
            showScreen(screenMain);
          });
          modulesContainer.appendChild(btn);
        }
      }

      // ====== Ø¹Ø±Ø¶ Ø§Ù„Ù‚Ø³Ù… ======
      function renderSection() {
        content.innerHTML = "";
        const md = moduleData[selectedSection];
        let totalTasks = 0,
          doneTasks = 0;
        const div = document.createElement("div");
        div.innerHTML = `<h3>${selectedSection}</h3>`;
        if (md.type === "models") {
          for (let i = 1; i <= md.count; i++) {
            totalTasks += TASKS.length;
          }
        } else if (md.type === "list") {
          md.items.forEach((item) => {
            totalTasks += TASKS.length;
          });
        }
        progressCount.textContent = `${doneTasks} / ${totalTasks}`;
        progressBar.style.width = "0%";
        content.appendChild(div);
      }

      // ====== Leaderboard ======
      function renderLeaderboard() {
        db.ref("users").once("value", (snapshot) => {
          const users = snapshot.val() || {};
          lbBody.innerHTML = "";
          const rows = Object.values(users);
          rows.sort((a, b) => b.pct - a.pct);
          rows.forEach((r, i) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `<td>${i + 1}</td><td>${r.name}</td><td>${
              r.pct || 0
            }%</td>`;
            lbBody.appendChild(tr);
          });
        });
      }

      // ====== Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø± ======
      btnStart.addEventListener("click", () => {
        username = document.getElementById("nameInput").value.trim();
        if (!username) return alert("Ø§Ø¯Ø®Ù„ Ø§Ø³Ù…Ùƒ");
        showScreen(screenModules);
        renderModules();
      });
      btnGoLB.addEventListener("click", () => {
        renderLeaderboard();
        showScreen(screenLB);
      });
      btnBackToStart.addEventListener("click", () => showScreen(screenStart));
      btnLeaderboard1.addEventListener("click", () => {
        renderLeaderboard();
        showScreen(screenLB);
      });
      btnBackToModules.addEventListener("click", () =>
        showScreen(screenModules)
      );
      btnLeaderboard2.addEventListener("click", () => {
        renderLeaderboard();
        showScreen(screenLB);
      });
      btnLBBackStart.addEventListener("click", () => showScreen(screenStart));
      btnLBBackModules.addEventListener("click", () =>
        showScreen(screenModules)
      );
    </script>
  </body>
</html>
